{% extends "base.html" %}

{% block title %}PDF Translation Bot - Demo{% endblock %}

{% block content %}
    <!-- Page Heading -->
    <div class="text-center mb-4">
        <h1 class="display-4 text-gradient">ðŸš€ PDF Translation Bot</h1>
        <p class="lead">Transform PDFs from any language to English with AI-powered translation</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Demo Status -->
            <div class="alert alert-success text-center mb-4">
                <i class="fas fa-check-circle me-2"></i>
                <strong>Application is Running!</strong> The PDF Translation Bot is successfully deployed and ready to use.
            </div>

            <!-- Features Card -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-star me-2"></i>Key Features</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li class="mb-2"><i class="fas fa-globe text-primary me-2"></i>Multi-language Support</li>
                                <li class="mb-2"><i class="fas fa-robot text-primary me-2"></i>Auto Language Detection</li>
                                <li class="mb-2"><i class="fas fa-layer-group text-primary me-2"></i>Batch Processing</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li class="mb-2"><i class="fas fa-mobile-alt text-primary me-2"></i>Responsive Design</li>
                                <li class="mb-2"><i class="fas fa-download text-primary me-2"></i>High-Quality Output</li>
                                <li class="mb-2"><i class="fas fa-shield-alt text-primary me-2"></i>Secure Processing</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upload Form -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-file-upload me-2"></i>Upload & Translate PDF</h5>
                </div>
                <div class="card-body">
                    <form id="pdfForm" class="needs-validation" novalidate>
                        <!-- Language Selection -->
                        <div class="mb-3">
                            <label for="sourceLang" class="form-label">Source Language</label>
                            <select class="form-select" id="sourceLang" required>
                                <option value="auto" selected>Auto-detect</option>
                                {% for lang_name, lang_code in languages.items() %}
                                    <option value="{{ lang_code }}">{{ lang_name.title() }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- File Input -->
                        <div class="mb-3">
                            <label for="pdfFile" class="form-label">Choose PDF File</label>
                            <input class="form-control" type="file" id="pdfFile" accept=".pdf" required>
                            <div class="form-text">Maximum file size: 50MB</div>
                            <div class="invalid-feedback">Please select a PDF file.</div>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary btn-lg w-100" id="translateBtn">
                            <i class="fas fa-magic me-2"></i>Start Translation
                        </button>
                    </form>

                    <!-- Status Display -->
                    <div id="statusDisplay" class="mt-3 d-none">
                        <div class="alert alert-info">
                            <div class="d-flex align-items-center">
                                <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                                <span id="statusMessage">Processing your PDF...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Result Display -->
                    <div id="resultDisplay" class="mt-3 d-none">
                        <div id="resultContent"></div>
                    </div>
                </div>
            </div>

            <!-- API Info -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-code me-2"></i>API Information</h5>
                </div>
                <div class="card-body">
                    <p>The application provides the following API endpoints:</p>
                    <ul>
                        <li><code>GET /</code> - Main interface</li>
                        <li><code>POST /upload</code> - Upload and translate files</li>
                        <li><code>GET /status/{task_id}</code> - Check translation status</li>
                        <li><code>GET /api/languages</code> - Get supported languages</li>
                        <li><code>GET /about</code> - About page</li>
                    </ul>
                    <a href="/api/languages" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-external-link-alt me-1"></i>View Languages API
                    </a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var form = document.getElementById("pdfForm");
            var currentTaskId = null;

            form.addEventListener("submit", function (event) {
                event.preventDefault();
                
                if (form.checkValidity()) {
                    var formData = new FormData();
                    formData.append("files[]", document.getElementById("pdfFile").files[0]);
                    formData.append("source_lang", document.getElementById("sourceLang").value);

                    // Show status
                    document.getElementById("statusDisplay").classList.remove("d-none");
                    document.getElementById("resultDisplay").classList.add("d-none");
                    document.getElementById("translateBtn").disabled = true;

                    fetch("/upload", {
                        method: "POST",
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.task_ids) {
                            currentTaskId = data.task_ids[0];
                            checkStatus();
                        } else {
                            showError(data.error || 'Upload failed');
                        }
                    })
                    .catch(error => {
                        showError('An error occurred: ' + error.message);
                    });

                } else {
                    form.classList.add("was-validated");
                }
            });

            function checkStatus() {
                if (!currentTaskId) return;

                fetch(`/status/${currentTaskId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'completed') {
                        showSuccess(data.download_url, data.original_file);
                    } else if (data.status === 'failed') {
                        showError(data.error || 'Translation failed');
                    } else if (data.status === 'processing') {
                        document.getElementById("statusMessage").textContent = `Processing ${data.original_file}...`;
                        setTimeout(checkStatus, 2000); // Check again in 2 seconds
                    } else {
                        document.getElementById("statusMessage").textContent = "Queued for processing...";
                        setTimeout(checkStatus, 1000); // Check again in 1 second
                    }
                })
                .catch(error => {
                    showError('Status check failed: ' + error.message);
                });
            }

            function showSuccess(downloadUrl, filename) {
                document.getElementById("statusDisplay").classList.add("d-none");
                document.getElementById("resultDisplay").classList.remove("d-none");
                document.getElementById("resultContent").innerHTML = `
                    <div class="alert alert-success">
                        <h6><i class="fas fa-check-circle me-2"></i>Translation Completed!</h6>
                        <p class="mb-2">Successfully translated: <strong>${filename}</strong></p>
                        <a href="${downloadUrl}" class="btn btn-success">
                            <i class="fas fa-download me-2"></i>Download Translated PDF
                        </a>
                    </div>
                `;
                document.getElementById("translateBtn").disabled = false;
            }

            function showError(message) {
                document.getElementById("statusDisplay").classList.add("d-none");
                document.getElementById("resultDisplay").classList.remove("d-none");
                document.getElementById("resultContent").innerHTML = `
                    <div class="alert alert-danger">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Translation Failed</h6>
                        <p class="mb-0">${message}</p>
                    </div>
                `;
                document.getElementById("translateBtn").disabled = false;
            }
        });
    </script>
{% endblock %}
